<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SMC Pro (Binance Market Orders)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            900: '#050505',
                            800: '#0A0A0A',
                            700: '#121212',
                            600: '#1C1C1C',
                        },
                        brand: {
                            green: '#00FF94',
                            red: '#FF3B30',
                            blue: '#007AFF',
                            yellow: '#FFCC00',
                            purple: '#BF5AF2'
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e5e5e5;
        }
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0A0A0A; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #262626; 
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #404040; 
        }
        
        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // --- IMPORTS ---
        import React, { useState, useEffect, useCallback, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            TrendingUp, TrendingDown, Activity, PlayCircle, StopCircle, Clock, 
            CheckCircle, XCircle, AlertTriangle, Cpu, DollarSign, Database, 
            Trash2, Filter, Search, LogOut, History, LayoutDashboard, User, List,
            Zap, Shield, BarChart2, Wallet, Lock, Unlock, Target, Layers, PauseCircle,
            RefreshCw, SkipForward, Globe, Check, Flame, Crosshair, BarChart4, RotateCcw
        } from 'https://esm.sh/lucide-react@0.344.0';

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyC0R1nyCU2OKR2eWGfsZ9vKrAB5lXu-jfA",
          authDomain: "ai-smc-auto-trader.firebaseapp.com",
          projectId: "ai-smc-auto-trader",
          storageBucket: "ai-smc-auto-trader.firebasestorage.app",
          messagingSenderId: "399840451622",
          appId: "1:399840451622:web:07ee2fe087759aeb0e1ae7",
          measurementId: "G-B1DYMS4HYZ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';

        // --- APP CONFIGURATION ---
        // BINANCE FUTURES PAIRS ONLY
        const FUTURES_PAIRS = [
          'BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 
          'ADAUSDT', 'DOGEUSDT', 'AVAXUSDT', 'LINKUSDT', 'MATICUSDT',
          'DOTUSDT', 'TRXUSDT', 'LTCUSDT', 'SHIBUSDT', 'UNIUSDT',
          'ATOMUSDT', 'ETCUSDT', 'FILUSDT', 'NEARUSDT', 'ALGOUSDT',
          'ICPUSDT', 'BCHUSDT', 'VETUSDT', 'FTMUSDT', 'SANDUSDT',
          'MANAUSDT', 'APEUSDT', 'AXSUSDT', 'EGLDUSDT', 'THETAUSDT',
          'AAVEUSDT', 'EOSUSDT', 'RUNEUSDT', 'GALAUSDT', 'OPUSDT',
          'ARBUSDT', 'APTUSDT', 'LDOUSDT', 'PEPEUSDT', 'SUIUSDT',
          'RNDRUSDT', 'INJUSDT', 'STXUSDT', 'CFXUSDT', 'AGIXUSDT',
          'WLDUSDT', 'TIAUSDT', 'SEIUSDT', 'ORDIUSDT', 'BONKUSDT',
          'WIFUSDT', 'STRKUSDT', 'PYTHUSDT', 'JTOUSDT', 'MEMEUSDT',
          'JUPUSDT', 'DYDXUSDT', 'IMXUSDT', 'SNXUSDT', 'CRVUSDT'
        ];

        const BINANCE_API = 'https://api.binance.com/api/v3';
        const TIMEFRAME = '5m'; 

        const CryptoAutoTrader = () => {
          // --- STATE ---
          const [user, setUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [isLoginView, setIsLoginView] = useState(true);
          const [authError, setAuthError] = useState('');

          const [signals, setSignals] = useState([]);
          const [prices, setPrices] = useState({});
          const [scanning, setScanning] = useState(false);
          const [logs, setLogs] = useState([]);
          const [stats, setStats] = useState({ wins: 0, losses: 0, active: 0, skipped: 0 });
          
          const [tradeTab, setTradeTab] = useState('RUNNING'); 
          const [isRecoveryMode, setIsRecoveryMode] = useState(false);

          const scanIntervalRef = useRef(null);
          const priceIntervalRef = useRef(null);
          
          const processingTradeRef = useRef(false);
          const signalsRef = useRef([]); 

          // --- LOGIC ---
          useEffect(() => {
            const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
              setUser(currentUser);
              setAuthLoading(false);
              if (currentUser) {
                  addLog(`SMC Node initialized: ${currentUser.email}`, 'success');
              }
            });
            return () => unsubscribe();
          }, []);

          useEffect(() => {
              if (user && !scanning) {
                  startScanner();
              } else if (!user && scanning) {
                  stopScanner();
              }
          }, [user]);

          useEffect(() => {
            if (!user) { setSignals([]); signalsRef.current = []; return; }
            const signalsRefFb = collection(db, 'artifacts', appId, 'users', user.uid, 'signals');
            const unsubscribe = onSnapshot(signalsRefFb, (snapshot) => {
              const loadedSignals = snapshot.docs.map(doc => ({ ...doc.data(), firestoreId: doc.id }));
              loadedSignals.sort((a, b) => b.timestamp - a.timestamp);
              
              setSignals(loadedSignals);
              signalsRef.current = loadedSignals; 
              
              const wins = loadedSignals.filter(s => s.status === 'WON').length;
              const losses = loadedSignals.filter(s => s.status === 'LOST').length;
              const active = loadedSignals.filter(s => s.status === 'ACTIVE').length;
              const skipped = loadedSignals.filter(s => s.status === 'SKIPPED').length;
              
              setStats({ wins, losses, active, skipped });

              if (active > 0) {
                  processingTradeRef.current = true; // Lock scanning
              } else {
                  processingTradeRef.current = false; // Unlock scanning
              }

              const closedTrades = loadedSignals.filter(s => s.status === 'WON' || s.status === 'LOST');
              if (closedTrades.length > 0) {
                  setIsRecoveryMode(closedTrades[0].status === 'LOST');
              }

            }, (error) => {
              console.error("Firestore Error:", error);
              addLog("Error syncing data from cloud", 'error');
            });
            return () => unsubscribe();
          }, [user]);

          const handleAuth = async (e) => {
            e.preventDefault();
            setAuthError('');
            try {
              if (isLoginView) await signInWithEmailAndPassword(auth, email, password);
              else await createUserWithEmailAndPassword(auth, email, password);
            } catch (err) { setAuthError(err.message.replace('Firebase: ', '')); }
          };

          const handleLogout = async () => { stopScanner(); await signOut(auth); };

          // --- DATA MANAGEMENT ---
          const handleResetData = async () => {
              if (!window.confirm("⚠️ WARNING: This will delete ALL trade history, win rates, and logs. This cannot be undone. Are you sure?")) {
                  return;
              }
              
              addLog("Resetting system data...", "warning");
              
              try {
                  // Delete all signals for this user
                  const deletePromises = signals.map(s => 
                      deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'signals', s.firestoreId))
                  );
                  
                  await Promise.all(deletePromises);
                  
                  // Clear local logs
                  setLogs([]);
                  addLog("System reset complete. Data cleared.", "success");
                  
              } catch (err) {
                  console.error("Error clearing data:", err);
                  addLog("Error resetting data.", "error");
              }
          };

          // --- SKIP FUNCTIONALITY ---
          const skipTrade = async (signalId, symbol) => {
              if (!user || !signalId) return;
              try {
                  const sigRef = doc(db, 'artifacts', appId, 'users', user.uid, 'signals', signalId);
                  await updateDoc(sigRef, { status: 'SKIPPED' });
                  addLog(`Skipped: ${symbol}.`, 'warning');
                  processingTradeRef.current = false; 
              } catch (err) {
                  console.error("Error skipping trade:", err);
              }
          };

          const addLog = (msg, type = 'info') => {
            const timestamp = new Date().toLocaleTimeString();
            setLogs(prev => [{ time: timestamp, msg, type }, ...prev].slice(0, 50));
          };

          const fetchPrices = async () => {
            try {
              const response = await fetch(`${BINANCE_API}/ticker/price`);
              const data = await response.json();
              const priceMap = {};
              data.forEach(d => { if (FUTURES_PAIRS.includes(d.symbol)) priceMap[d.symbol] = parseFloat(d.price); });
              setPrices(priceMap);
              updateSignalStatus(priceMap);
            } catch (err) { console.error("Price fetch error", err); }
          };

          const updateSignalStatus = async (currentPrices) => {
            if (!user) return;
            signals.forEach(async (signal) => {
              const currentPrice = currentPrices[signal.symbol];
              if (!currentPrice || signal.status === 'WON' || signal.status === 'LOST' || signal.status === 'SKIPPED') return;

              let newStatus = signal.status;
              let closePrice = signal.closePrice;
              let shouldUpdate = false;
              let logMsg = '';
              let logType = 'info';

              if (newStatus === 'ACTIVE') {
                if (signal.type === 'LONG') {
                  if (currentPrice >= signal.tp) { 
                      newStatus = 'WON'; closePrice = signal.tp; shouldUpdate = true; logMsg = `${signal.symbol} TP HIT! SMC Win.`; logType = 'success'; 
                  } else if (currentPrice <= signal.sl) { 
                      newStatus = 'LOST'; closePrice = signal.sl; shouldUpdate = true; logMsg = `${signal.symbol} SL HIT.`; logType = 'error'; 
                  }
                } else { 
                  if (currentPrice <= signal.tp) { 
                      newStatus = 'WON'; closePrice = signal.tp; shouldUpdate = true; logMsg = `${signal.symbol} TP HIT! SMC Win.`; logType = 'success'; 
                  } else if (currentPrice >= signal.sl) { 
                      newStatus = 'LOST'; closePrice = signal.sl; shouldUpdate = true; logMsg = `${signal.symbol} SL HIT.`; logType = 'error'; 
                  }
                }
              }

              if (shouldUpdate && signal.firestoreId) {
                try {
                  const sigRef = doc(db, 'artifacts', appId, 'users', user.uid, 'signals', signal.firestoreId);
                  await updateDoc(sigRef, { status: newStatus, closePrice: closePrice || null });
                  addLog(logMsg, logType);
                } catch (err) { console.error("Error updating signal:", err); }
              }
            });
          };

          // --- SMC STRATEGY: LIQUIDITY SWEEPS (SFP) ---
          const analyzePair = async (symbol) => {
            if (!user) return;
            if (processingTradeRef.current) return;
            
            const hasActive = signalsRef.current.some(s => s.status === 'ACTIVE');
            if (hasActive) {
                processingTradeRef.current = true; 
                return;
            }

            try {
              // 100 Candles to find structure
              const res = await fetch(`${BINANCE_API}/klines?symbol=${symbol}&interval=${TIMEFRAME}&limit=100`);
              const rawData = await res.json();
              const candles = rawData.map(c => ({ 
                  open: parseFloat(c[1]), 
                  high: parseFloat(c[2]), 
                  low: parseFloat(c[3]), 
                  close: parseFloat(c[4]), 
                  vol: parseFloat(c[5]) 
              }));
              
              if (candles.length < 50) return;

              const last = candles[candles.length - 1]; // Current Candle (Live)
              const prev = candles[candles.length - 2]; // Completed Candle
              
              const currentPrice = last.close;
              const atr = calculateATR(candles, 14);

              let signalData = null;

              const LOOKBACK = 15;
              let swingHigh = -Infinity;
              let swingLow = Infinity;

              for (let i = candles.length - 3; i > candles.length - 3 - LOOKBACK; i--) {
                  if (candles[i].high > swingHigh) swingHigh = candles[i].high;
                  if (candles[i].low < swingLow) swingLow = candles[i].low;
              }

              // LONG SETUP: MARKET ORDER
              if (prev.low < swingLow && prev.close > swingLow) {
                  if (last.close > prev.low) {
                      const slDist = atr * 1.5;
                      const sl = prev.low - (atr * 0.2); 
                      const tp = currentPrice + (Math.abs(currentPrice - sl) * 1.5); 
                      
                      signalData = { type: 'LONG', entry: currentPrice, sl, tp, reason: "MARKET BUY: Liquidity Sweep" };
                  }
              }

              // SHORT SETUP: MARKET ORDER
              else if (prev.high > swingHigh && prev.close < swingHigh) {
                  if (last.close < prev.high) {
                      const sl = prev.high + (atr * 0.2); 
                      const tp = currentPrice - (Math.abs(sl - currentPrice) * 1.5); 
                      
                      signalData = { type: 'SHORT', entry: currentPrice, sl, tp, reason: "MARKET SELL: Liquidity Sweep" };
                  }
              }

              if (signalData && !processingTradeRef.current) {
                  const currentActive = signalsRef.current.some(s => s.status === 'ACTIVE');
                  if (currentActive) return;

                  processingTradeRef.current = true; 
                  
                  const newSignal = {
                      symbol, 
                      type: signalData.type, 
                      entry: parseFloat(signalData.entry.toFixed(4)), 
                      sl: parseFloat(signalData.sl.toFixed(4)), 
                      tp: parseFloat(signalData.tp.toFixed(4)),
                      status: 'ACTIVE', 
                      reason: signalData.reason, 
                      timestamp: Date.now(), 
                      mode: 'MARKET_ORDER'
                  };
                  await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'signals'), newSignal);
                  addLog(`MARKET EXECUTION: ${symbol} (${signalData.type})`, 'success');
              }
            } catch (err) { 
                console.error(`Analysis failed for ${symbol}`, err);
            }
          };

          // --- HELPERS ---
          const calculateATR = (candles, period) => {
            let trSum = 0;
            for (let i = 1; i < candles.length; i++) {
                const high = candles[i].high; const low = candles[i].low; const closePrev = candles[i-1].close;
                const tr = Math.max(high - low, Math.abs(high - closePrev), Math.abs(low - closePrev)); trSum += tr;
            }
            return trSum / period;
          };

          const startScanner = () => {
            if (scanning) return;
            setScanning(true); 
            addLog(`SYSTEM STARTED: Binance Market Orders`, "success");
            
            FUTURES_PAIRS.forEach((pair, index) => { setTimeout(() => analyzePair(pair), index * 500); });
            
            scanIntervalRef.current = setInterval(() => { 
                const hasActive = signalsRef.current.some(s => s.status === 'ACTIVE');
                if (!hasActive && !processingTradeRef.current) {
                    addLog(`Scanning Binance Futures (${FUTURES_PAIRS.length} pairs)...`, "info"); 
                    FUTURES_PAIRS.forEach((pair, index) => { setTimeout(() => analyzePair(pair), index * 800); }); 
                }
            }, 15000); 
            
            priceIntervalRef.current = setInterval(fetchPrices, 3000);
          };

          const stopScanner = () => { setScanning(false); clearInterval(scanIntervalRef.current); clearInterval(priceIntervalRef.current); addLog("Scanner Stopped.", "warning"); };

          // --- UI RENDERING ---

          if (authLoading) return <div className="min-h-screen bg-dark-900 flex items-center justify-center text-brand-green font-mono"><div className="animate-spin text-4xl">✱</div></div>;

          if (!user) {
            return (
              <div className="min-h-screen bg-dark-900 flex items-center justify-center p-4">
                <div className="glass-panel p-8 rounded-2xl max-w-md w-full border border-white/10">
                  <h1 className="text-2xl font-bold text-white mb-6 text-center">AI <span className="text-brand-green">SMC</span> TRADER</h1>
                  <form onSubmit={handleAuth} className="space-y-4">
                    <input type="email" required className="w-full bg-dark-800 p-3 rounded text-white border border-dark-600 focus:border-brand-green outline-none" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} />
                    <input type="password" required className="w-full bg-dark-800 p-3 rounded text-white border border-dark-600 focus:border-brand-green outline-none" placeholder="Password" value={password} onChange={e=>setPassword(e.target.value)} />
                    <button type="submit" className="w-full bg-brand-green text-dark-900 font-bold py-3 rounded hover:bg-emerald-400 transition">{isLoginView ? 'LOGIN TO AUTO-START' : 'REGISTER NODE'}</button>
                  </form>
                  <button onClick={() => setIsLoginView(!isLoginView)} className="w-full text-center text-xs text-gray-500 mt-4 hover:text-white">{isLoginView ? 'Create Account' : 'Login'}</button>
                </div>
              </div>
            );
          }

          const activeSignals = signals.filter(s => s.status === 'ACTIVE');
          const hasActiveTrade = activeSignals.length > 0;
          const wonSignals = signals.filter(s => s.status === 'WON');
          const lostSignals = signals.filter(s => s.status === 'LOST');
          const skippedSignals = signals.filter(s => s.status === 'SKIPPED');

          let displayedList = [];
          if (tradeTab === 'RUNNING') displayedList = activeSignals;
          if (tradeTab === 'WON') displayedList = wonSignals;
          if (tradeTab === 'LOST') displayedList = lostSignals;
          if (tradeTab === 'SKIPPED') displayedList = skippedSignals;

          return (
            <div className="min-h-screen bg-dark-900 text-gray-300 font-sans">
              <header className="sticky top-0 z-50 glass-panel border-b border-white/5 h-16 flex items-center justify-between px-4">
                 <div className="flex items-center gap-3">
                    <div className="bg-brand-green/20 p-2 rounded"><BarChart4 className="text-brand-green" size={18} /></div>
                    <div>
                        <h1 className="text-base font-bold text-white">AI SMC <span className="text-brand-green">PRO</span></h1>
                        <div className="flex items-center gap-2 text-[10px] text-gray-500">
                           <span className="w-1.5 h-1.5 rounded-full bg-brand-green animate-pulse-fast"></span>
                           {hasActiveTrade ? 'MANAGING SMC TRADE' : 'SCANNING LIQUIDITY'}
                        </div>
                    </div>
                 </div>
                 <div className="flex items-center gap-3">
                    <div className="flex items-center gap-2 bg-dark-800 border border-white/5 px-3 py-1.5 rounded text-[10px] font-bold text-brand-green">
                        <Globe size={12} className="animate-spin"/>
                        MARKET ORDERS
                    </div>
                    {/* RESET DATA BUTTON */}
                    <button onClick={handleResetData} title="Clear All History" className="p-2 text-brand-red hover:bg-brand-red/10 rounded transition-colors border border-brand-red/20">
                        <Trash2 size={16}/>
                    </button>
                    <button onClick={handleLogout} className="p-2 text-gray-500 hover:text-white"><LogOut size={16}/></button>
                 </div>
              </header>

              <main className="max-w-7xl mx-auto p-4 space-y-4">
                 <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="glass-panel p-4 rounded-xl">
                        <span className="text-[10px] font-bold text-gray-500 uppercase">Win Rate</span>
                        <h2 className="text-3xl font-mono font-bold text-white mt-1">
                            {stats.wins + stats.losses > 0 ? ((stats.wins / (stats.wins + stats.losses)) * 100).toFixed(0) : 0}%
                        </h2>
                    </div>
                    <div className="glass-panel p-4 rounded-xl flex items-center justify-between">
                        <div>
                            <span className="text-[10px] font-bold text-gray-500 uppercase">Status</span>
                            <h2 className={`text-xl font-mono font-bold mt-1 ${hasActiveTrade ? 'text-brand-blue' : 'text-brand-green'}`}>
                                {hasActiveTrade ? 'ACTIVE' : 'SCANNING'}
                            </h2>
                            <p className="text-[10px] text-gray-500">Binance Futures</p>
                        </div>
                        {hasActiveTrade ? <Lock className="text-brand-blue" size={24}/> : <BarChart4 className="text-brand-green" size={24}/>}
                    </div>
                    <div className="glass-panel p-4 rounded-xl">
                        <span className="text-[10px] font-bold text-gray-500 uppercase">Wins</span>
                        <h2 className="text-3xl font-mono font-bold text-brand-green mt-1">{stats.wins}</h2>
                    </div>
                    <div className="glass-panel p-4 rounded-xl">
                        <span className="text-[10px] font-bold text-gray-500 uppercase">Skipped</span>
                        <h2 className="text-3xl font-mono font-bold text-gray-400 mt-1">{stats.skipped}</h2>
                    </div>
                 </div>

                 <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-2 space-y-4">
                        <div className="flex gap-2 bg-dark-800/50 p-1 rounded-lg w-fit overflow-x-auto">
                            {['RUNNING', 'WON', 'LOST', 'SKIPPED'].map(tab => (
                                <button key={tab} onClick={() => setTradeTab(tab)} className={`px-4 py-2 rounded text-xs font-bold transition-all whitespace-nowrap ${tradeTab === tab ? 'bg-white/10 text-white' : 'text-gray-500'}`}>
                                    {tab}
                                </button>
                            ))}
                        </div>

                        {hasActiveTrade && tradeTab === 'RUNNING' && (
                             <div className="p-4 bg-brand-blue/10 border border-brand-blue/30 rounded-lg flex items-center gap-3 animate-pulse">
                                 <PauseCircle className="text-brand-blue" />
                                 <span className="text-brand-blue text-xs font-bold">SCANNER PAUSED: Trade active.</span>
                             </div>
                        )}

                        <div className="space-y-3">
                            {displayedList.length === 0 && <div className="text-center py-10 text-gray-600 text-sm">No {tradeTab.toLowerCase()} trades.</div>}
                            {displayedList.map(signal => {
                                const currentPrice = prices[signal.symbol] || signal.entry;
                                const pnl = ((currentPrice - signal.entry) / signal.entry) * 100 * (signal.type === 'SHORT' ? -1 : 1);
                                return (
                                    <div key={signal.firestoreId} className="glass-panel p-5 rounded-xl border-l-4 border-l-brand-blue hover:bg-white/5 transition relative overflow-hidden">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xl font-bold text-white font-mono">{signal.symbol}</span>
                                                    <span className={`px-2 text-[10px] font-bold rounded ${signal.type === 'LONG' ? 'bg-brand-green/20 text-brand-green' : 'bg-brand-red/20 text-brand-red'}`}>{signal.type}</span>
                                                    {signal.mode === 'MARKET_ORDER' && <span className="text-[8px] bg-brand-yellow/10 text-brand-yellow px-1 rounded border border-brand-yellow/20">MARKET</span>}
                                                </div>
                                                <div className="text-xs text-gray-500 mt-1">{new Date(signal.timestamp).toLocaleTimeString()} • {signal.reason}</div>
                                            </div>
                                            <div className="text-right flex flex-col items-end gap-2">
                                                {signal.status === 'ACTIVE' ? (
                                                    <>
                                                        <span className={`text-2xl font-bold font-mono ${pnl >= 0 ? 'text-brand-green' : 'text-brand-red'}`}>
                                                            {pnl > 0 ? '+' : ''}{pnl.toFixed(2)}%
                                                        </span>
                                                        <button 
                                                          onClick={() => skipTrade(signal.firestoreId, signal.symbol)}
                                                          className="flex items-center gap-1 bg-dark-800 hover:bg-dark-700 text-gray-400 hover:text-white px-2 py-1 rounded text-[10px] font-bold border border-white/10 transition-colors"
                                                        >
                                                            <SkipForward size={10}/> SKIP
                                                        </button>
                                                    </>
                                                ) : (
                                                    <span className={`font-bold ${
                                                        signal.status === 'WON' ? 'text-brand-green' : 
                                                        signal.status === 'LOST' ? 'text-brand-red' : 'text-gray-500'
                                                    }`}>
                                                        {signal.status}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-3 gap-2 mt-4 text-center">
                                            <div className="bg-dark-800 p-2 rounded"><div className="text-[10px] text-gray-500">ENTRY</div><div className="text-white font-mono">{signal.entry}</div></div>
                                            <div className="bg-dark-800 p-2 rounded"><div className="text-[10px] text-gray-500">SL</div><div className="text-brand-red font-mono">{signal.sl}</div></div>
                                            <div className="bg-dark-800 p-2 rounded"><div className="text-[10px] text-gray-500">TP</div><div className="text-brand-green font-mono">{signal.tp}</div></div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="lg:col-span-1">
                        <div className="glass-panel rounded-xl h-[400px] flex flex-col">
                            <div className="p-3 border-b border-white/5 font-bold text-xs text-gray-400">LOGS</div>
                            <div className="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
                                {logs.map((log, i) => (
                                    <div key={i} className="text-[10px] font-mono border-l-2 border-white/10 pl-2">
                                        <span className="text-gray-500">{log.time}</span> <span className={log.type === 'success' ? 'text-brand-green' : log.type === 'warning' ? 'text-brand-yellow' : 'text-gray-300'}>{log.msg}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                 </div>
              </main>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<CryptoAutoTrader />);
    </script>
</body>
</html>